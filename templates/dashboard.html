{% extends "base.html" %}

{% block title %}{{ league_name }} - Vantix{% endblock %}

{% block content %}
<div class="app-container">
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="brand">
                <div>
                    <div class="brand-logo">Vantix</div>
                    <div class="brand-subtitle">{{ league_name }} ‚Ä¢ {{ season }} Season</div>
                </div>
            </div>
            <div class="header-meta">
                <div class="current-gameweek">
                    Current Gameweek: <span>GW {{ current_gameweek }}</span>
                </div>
                {% if last_update %}
                <div class="last-updated">
                    Last updated: {{ last_update }}
                </div>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- Master Team Filter -->
    <section class="master-filter">
        <div class="filter-header">
            <div class="filter-title">Filter Teams</div>
            <div class="filter-actions">
                <button class="btn-filter" id="selectAllMaster">Select All</button>
                <button class="btn-filter" id="deselectAllMaster">Deselect All</button>
            </div>
        </div>
        <div class="team-pills-master" id="masterTeamPills">
            <!-- Team pills will be dynamically generated -->
        </div>
    </section>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Current Leader</div>
            <div class="stat-value" id="stat-leader-value">-</div>
            <div class="stat-detail" id="stat-leader-detail">Loading...</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Most Goals</div>
            <div class="stat-value" id="stat-goals-value">-</div>
            <div class="stat-detail" id="stat-goals-detail">Loading...</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Most Clean Sheets</div>
            <div class="stat-value" id="stat-cs-value">-</div>
            <div class="stat-detail" id="stat-cs-detail">Loading...</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Highest GW Score</div>
            <div class="stat-value" id="stat-highest-value">-</div>
            <div class="stat-detail" id="stat-highest-detail">Loading...</div>
        </div>
    </div>

    <!-- Cumulative Points Chart -->
    <section class="chart-section">
        <div class="chart-header">
            <h2 class="chart-title">Cumulative Points</h2>
            <p class="chart-description">Track total points progression throughout the season</p>
        </div>
        <div class="chart-container">
            <canvas id="cumulativePointsChart"></canvas>
        </div>
    </section>

    <!-- League Position Worm Chart -->
    <section class="chart-section">
        <div class="chart-header">
            <h2 class="chart-title">League Position Tracker</h2>
            <p class="chart-description">Watch rank changes over time</p>
            <div class="chip-legend" id="chipLegend">
                <!-- Chip legend will be dynamically generated -->
            </div>
        </div>
        <div class="chart-container">
            <canvas id="leaguePositionChart"></canvas>
        </div>
    </section>

    <!-- Recent Transfers -->
    <section class="transfers-section">
        <div class="chart-header">
            <h2 class="chart-title">Recent Transfers (<span id="transfersGameweek">GW {{ current_gameweek }}</span>)</h2>
            <p class="chart-description">Latest squad changes by selected teams</p>
        </div>
        <div class="transfers-list" id="transfersList">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading transfers...</p>
            </div>
        </div>
    </section>

    <!-- Recent Form Chart -->
    <section class="chart-section">
        <div class="chart-header">
            <h2 class="chart-title">Recent Form</h2>
            <p class="chart-description">Points scored in the last 5 gameweeks</p>
        </div>
        <div class="chart-container">
            <canvas id="formChart"></canvas>
        </div>
    </section>

    <!-- Points Distribution -->
    <section class="chart-section">
        <div class="chart-header">
            <h2 class="chart-title">Points Distribution</h2>
            <p class="chart-description">How gameweek scores are spread across the league</p>
        </div>
        <div class="chart-container">
            <canvas id="distributionChart"></canvas>
        </div>
    </section>

    <!-- THE PODIUM - Top 3 -->
    <section class="podium-section">
        <div class="chart-header">
            <h2 class="chart-title">üèÜ The Podium</h2>
            <p class="chart-description">Current top 3 leaders</p>
        </div>
        <div class="podium-display" id="podiumDisplay">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading podium...</p>
            </div>
        </div>
    </section>

    <!-- Transfer Strategy -->
    <section class="stats-comparison">
        <div class="chart-header">
            <h2 class="chart-title">üí∞ Transfer Strategy</h2>
            <p class="chart-description">Hits taken and points lost to transfers</p>
        </div>
        <div class="comparison-grid" id="transferStrategyGrid">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading strategy...</p>
            </div>
        </div>
    </section>

    <!-- Captain Performance Heatmap -->
    <section class="heatmap-section">
        <div class="chart-header">
            <h2 class="chart-title">üéØ Weekly Performance Heatmap</h2>
            <p class="chart-description">Gameweek points visualized by intensity</p>
        </div>
        <div class="heatmap-container" id="captainHeatmap">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading heatmap...</p>
            </div>
        </div>
    </section>

    <!-- Head-to-Head Mini League -->
    <section class="h2h-section">
        <div class="chart-header">
            <h2 class="chart-title">‚öîÔ∏è Head-to-Head Record</h2>
            <p class="chart-description">Weekly wins among selected teams</p>
        </div>
        <div class="h2h-container" id="headToHeadTable">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading records...</p>
            </div>
        </div>
    </section>

    <!-- Points Sources Breakdown -->
    <section class="chart-section">
        <div class="chart-header">
            <h2 class="chart-title">üìä Points by Position</h2>
            <p class="chart-description">Contribution from each position</p>
        </div>
        <div class="chart-container">
            <canvas id="pointsSourcesChart"></canvas>
        </div>
    </section>

    <!-- Differential Tracker -->
    <section class="differentials-section">
        <div class="chart-header">
            <h2 class="chart-title">üíé Differential Tracker</h2>
            <p class="chart-description">Unique player picks</p>
        </div>
        <div class="differentials-grid" id="differentialsGrid">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading differentials...</p>
            </div>
        </div>
    </section>

    <!-- Head-to-Head Comparison -->
    <section class="stats-comparison">
        <div class="chart-header">
            <h2 class="chart-title">Team Comparison</h2>
            <p class="chart-description">Detailed stats for selected teams</p>
        </div>
        <div class="comparison-grid" id="comparisonGrid">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading comparison...</p>
            </div>
        </div>
    </section>

    <!-- Biggest Movers -->
    <section class="movers-section">
        <div class="chart-header">
            <h2 class="chart-title">Biggest Movers (Last 5 GWs)</h2>
            <p class="chart-description">Who's climbing and who's falling?</p>
        </div>
        <div class="movers-grid" id="moversGrid">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading movers...</p>
            </div>
        </div>
    </section>

    <!-- Refresh Button -->
    <button class="refresh-button" id="refreshButton" title="Refresh data">
        ‚Üª
    </button>

    <!-- Footer -->
    <footer class="footer">
        <p>Powered by Fantasy Premier League API</p>
    </footer>
</div>

<!-- Pass data to JavaScript -->
<script>
    window.FPL_DATA = {
        teams: {{ teams | tojson }},
        currentGameweek: {{ current_gameweek }}
    };
</script>
{% endblock %}
